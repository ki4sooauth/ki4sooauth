<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper
	namespace="com.gooagoo.dao.business.sys.nominate.NominateGoodsAdapterMapper">
	<resultMap id="BaseResultMap"
		type="com.gooagoo.entity.business.system.nominate.NominateGoodsBusiness">
		<id column="gsng_id" property="id" jdbcType="CHAR" />
		<result column="shop_id" property="shopId" jdbcType="CHAR" />
		<result column="shop_entity_id" property="shopEntityId"
			jdbcType="CHAR" />
		<result column="goods_id" property="goodsId" jdbcType="CHAR" />
		<result column="start_time" property="startTime" jdbcType="TIMESTAMP" />
		<result column="end_time" property="endTime" jdbcType="TIMESTAMP" />
		<result column="c_time_stamp" property="nominateGoodsCTimeStamp"
			jdbcType="TIMESTAMP" />
		<result column="goods_name" property="goodsName" jdbcType="CHAR" />
		<result column="goods_serial" property="goodsSerial" jdbcType="CHAR" />
		<result column="item_serial" property="itemSerial" jdbcType="CHAR" />
		<result column="publish_status" property="publishStatus"
			jdbcType="CHAR" />
		<result column="price" property="price" jdbcType="CHAR" />
		<result column="c_time_stamps" property="goodsBaseInfoCTimeStamp"
			jdbcType="TIMESTAMP" />
		<result column="isNominate" property="isNominate" jdbcType="CHAR" />
		<result column="shop_name" property="shopName" jdbcType="CHAR" />
		<result column="shop_entity_name" property="shopEntityName"
			jdbcType="CHAR" />
	</resultMap>
	<!-- 按NominateGoodsBusiness（推荐商品）模糊查询推荐商品信息 -->
	<select id="findNominateGoodsBusiness" resultMap="BaseResultMap">
		SELECT
		gbis.shop_id AS shop_id,
		gbis.shop_entity_id AS shop_entity_id,
		gbis.goods_id AS goods_id,
		gbis.goods_name AS goods_name,
		gbis.goods_serial AS goods_serial,
		gbis.item_serial AS item_serial,
		gbis.publish_status AS publish_status,
		gbis.price AS price,
		gbis.c_time_stamps AS c_time_stamps,
		gbis.shop_name AS shop_name,
		gbis.shop_entity_name AS shop_entity_name,
		gbis.isNominate AS
		isNominate
		FROM
		(
		SELECT
		gssi.shop_id AS shop_id,
		gssei.shop_entity_id AS
		shop_entity_id,
		gbi.goods_id AS goods_id,
		gbi.goods_name AS goods_name,
		gbi.goods_serial AS goods_serial,
		gbi.item_serial AS item_serial,
		gbi.publish_status AS publish_status,
		gbi.price AS price,
		gbi.c_time_stamp AS c_time_stamps,
		gssi.shop_name AS shop_name,
		gssei.shop_entity_name AS shop_entity_name,
		(
		CASE
		WHEN (
		SELECT
		count(*)
		FROM
		gooagoo_sys.nominate_goods n
		WHERE
		n.goods_id = gbi.goods_id
		AND
		n.start_time &lt;= SYSDATE()
		AND n.end_time >= SYSDATE()
		AND n.is_del =
		'N'
		) > 0 THEN
		'Y'
		ELSE
		'N'
		END
		) isNominate
		FROM
		gooagoo_goods.goods_base_info
		gbi
		LEFT JOIN gooagoo_shop.shop_info gssi
		ON gbi.shop_id =
		gssi.shop_id
		LEFT JOIN gooagoo_shop.shop_entity_info
		gssei ON
		gbi.shop_entity_id =
		gssei.shop_entity_id
		WHERE
		gbi.is_del = 'N'
		AND gbi.publish_status = 'P'
		) gbis
		WHERE 1=1
		<if test="nominateGoodsBusiness.goodsName != null">
			AND gbis.goods_name like
			CONCAT('%',#{nominateGoodsBusiness.goodsName},'%')
		</if>
		<if test="nominateGoodsBusiness.shopId != null">
			AND gbis.shop_id = #{nominateGoodsBusiness.shopId}
		</if>
		<if test="nominateGoodsBusiness.shopEntityId != null">
			AND gbis.shop_entity_id
			=#{nominateGoodsBusiness.shopEntityId}
		</if>
		<if test="nominateGoodsBusiness.goodsId != null">
			AND gbis.goods_id =#{nominateGoodsBusiness.goodsId}
		</if>
		<if test="nominateGoodsBusiness.goodsSerial != null">
			AND gbis.goods_serial =
			#{nominateGoodsBusiness.goodsSerial}
		</if>
		<if test="nominateGoodsBusiness.itemSerial != null">
			AND gbis.item_serial = #{nominateGoodsBusiness.itemSerial}
		</if>
		<if test="nominateGoodsBusiness.shopName != null">
			AND gbis.shop_name like
			CONCAT('%',#{nominateGoodsBusiness.shopName},'%')
		</if>
		<if test="nominateGoodsBusiness.shopEntityName != null">
			AND gbis.shop_entity_name like
			CONCAT('%',#{nominateGoodsBusiness.shopEntityName},'%')
		</if>
		<if test="nominateGoodsBusiness.isNominate=='Y'.toString()">
			AND gbis.isNominate = 'Y'
		</if>
		<if test="nominateGoodsBusiness.isNominate=='N'.toString()">
			AND gbis.isNominate = 'N'
		</if>
		<if test="pageSize != null">
			limit
			<if test="pageIndex != null">
				${pageIndex},
			</if>
			${pageSize}
		</if>
	</select>


	<!-- 按NominateGoodsBusiness（推荐商品）模糊查询推荐商品信息 -->
	<select id="countNominateGoodsBusiness" resultType="java.lang.Integer">
		SELECT
		COUNT(gbiss.goods_id)
		FROM
		(
		SELECT
		gbis.shop_id AS shop_id,
		gbis.shop_entity_id AS shop_entity_id,
		gbis.goods_id AS goods_id,
		gbis.goods_name AS goods_name,
		gbis.goods_serial AS goods_serial,
		gbis.item_serial AS item_serial,
		gbis.publish_status AS publish_status,
		gbis.price AS price,
		gbis.c_time_stamps AS c_time_stamps,
		gbis.shop_name AS shop_name,
		gbis.shop_entity_name AS shop_entity_name,
		gbis.isNominate AS
		isNominate
		FROM
		(
		SELECT
		gssi.shop_id AS shop_id,
		gssei.shop_entity_id AS
		shop_entity_id,
		gbi.goods_id AS goods_id,
		gbi.goods_name AS goods_name,
		gbi.goods_serial AS goods_serial,
		gbi.item_serial AS item_serial,
		gbi.publish_status AS publish_status,
		gbi.price AS price,
		gbi.c_time_stamp AS c_time_stamps,
		gssi.shop_name AS
		shop_name,
		gssei.shop_entity_name AS shop_entity_name,
		(
		CASE
		WHEN (
		SELECT
		count(*)
		FROM
		gooagoo_sys.nominate_goods n
		WHERE
		n.goods_id =
		gbi.goods_id
		AND
		n.start_time &lt;= SYSDATE()
		AND n.end_time >= SYSDATE()
		AND n.is_del = 'N'
		) > 0 THEN
		'Y'
		ELSE
		'N'
		END
		) isNominate
		FROM
		gooagoo_goods.goods_base_info
		gbi
		LEFT JOIN gooagoo_shop.shop_info gssi
		ON gbi.shop_id =
		gssi.shop_id
		LEFT JOIN gooagoo_shop.shop_entity_info
		gssei ON
		gbi.shop_entity_id =
		gssei.shop_entity_id
		WHERE
		gbi.is_del = 'N'
		AND gbi.publish_status = 'P'
		) gbis
		WHERE 1=1
		<if test="nominateGoodsBusiness.goodsName != null">
			AND gbis.goods_name like
			CONCAT('%',#{nominateGoodsBusiness.goodsName},'%')
		</if>
		<if test="nominateGoodsBusiness.shopId != null">
			AND gbis.shop_id = #{nominateGoodsBusiness.shopId}
		</if>
		<if test="nominateGoodsBusiness.shopEntityId != null">
			AND gbis.shop_entity_id
			=#{nominateGoodsBusiness.shopEntityId}
		</if>
		<if test="nominateGoodsBusiness.goodsId != null">
			AND gbis.goods_id =#{nominateGoodsBusiness.goodsId}
		</if>
		<if test="nominateGoodsBusiness.goodsSerial != null">
			AND gbis.goods_serial =
			#{nominateGoodsBusiness.goodsSerial}
		</if>
		<if test="nominateGoodsBusiness.itemSerial != null">
			AND gbis.item_serial = #{nominateGoodsBusiness.itemSerial}
		</if>
		<if test="nominateGoodsBusiness.shopName != null">
			AND gbis.shop_name like
			CONCAT('%',#{nominateGoodsBusiness.shopName},'%')
		</if>
		<if test="nominateGoodsBusiness.shopEntityName != null">
			AND gbis.shop_entity_name like
			CONCAT('%',#{nominateGoodsBusiness.shopEntityName},'%')
		</if>
		<if test="nominateGoodsBusiness.isNominate=='Y'.toString()">
			AND gbis.isNominate = 'Y'
		</if>
		<if test="nominateGoodsBusiness.isNominate=='N'.toString()">
			AND gbis.isNominate = 'N'
		</if>
		) gbiss
	</select>
	<select id="findNominateGoods" resultMap="BaseResultMap">
		SELECT
		gsng.id AS id,
		gsng.goods_id AS goods_id,
		gsng.shop_entity_id AS
		shop_entity_id,
		gsng.shop_id AS shop_id,
		gbis.goods_name AS goods_name,
		gssei.shop_entity_name AS shop_entity_name,
		gssi.shop_name AS
		shop_name,
		gsng.start_time AS start_time,
		gsng.end_time AS end_time,
		gsng.c_time_stamp AS c_time_stamp
		FROM
		gooagoo_sys.nominate_goods gsng
		LEFT JOIN gooagoo_goods.goods_base_info gbis ON gsng.goods_id =
		gbis.goods_id
		LEFT JOIN gooagoo_shop.shop_info gssi ON gbis.shop_id =
		gssi.shop_id
		LEFT JOIN gooagoo_shop.shop_entity_info gssei ON
		gbis.shop_entity_id =
		gssei.shop_entity_id
		WHERE 1=1 AND
		gsng.is_del =
		'N'
		<if test="nominateGoodsBusiness.goodsName != null">
			AND gbis.goods_name like
			CONCAT('%',#{nominateGoodsBusiness.goodsName},'%')
		</if>
		<if test="nominateGoodsBusiness.goodsId != null">
			AND gsng.goods_id=#{nominateGoodsBusiness.goodsId}
		</if>
		<if test="nominateGoodsBusiness.shopId != null">
			AND gsng.shop_id=
			#{nominateGoodsBusiness.shopId}
		</if>
		<if test="nominateGoodsBusiness.Id != null">
			AND gsng.id=
			#{nominateGoodsBusiness.Id}
		</if>
		<if test="nominateGoodsBusiness.shopEntityId != null">
			AND gsng.shop_entity_id=
			#{nominateGoodsBusiness.shopEntityId}
		</if>
		<if test="nominateGoodsBusiness.shopName != null">
			AND gssi.shop_name like
			CONCAT('%',#{nominateGoodsBusiness.shopName},'%')
		</if>
		<if test="nominateGoodsBusiness.shopEntityName != null">
			AND gssei.shop_entity_name like
			CONCAT('%',#{nominateGoodsBusiness.shopEntityName},'%')
		</if>
		<if test="nominateGoodsBusiness.startTime != null">
			AND gsng.start_time >=
			#{nominateGoodsBusiness.startTime}
		</if>
		<if test="nominateGoodsBusiness.endTime != null">
			AND gsng.end_time &lt;=
			#{nominateGoodsBusiness.endTime}
		</if>
		<if test="pageSize != null">
			limit
			<if test="pageIndex != null">
				${pageIndex},
			</if>
			${pageSize}
		</if>
	</select>
	<select id="countNominateGoods" resultType="java.lang.Integer">
		select count(1) from(
		SELECT
		gsng.id AS id,
		gsng.goods_id AS goods_id,
		gsng.shop_entity_id AS
		shop_entity_id,
		gsng.shop_id AS shop_id,
		gbis.goods_name AS goods_name,
		gssei.shop_entity_name AS
		shop_entity_name,
		gssi.shop_name AS
		shop_name,
		gsng.start_time AS
		start_time,
		gsng.end_time AS end_time,
		gsng.c_time_stamp AS c_time_stamp
		FROM
		gooagoo_sys.nominate_goods gsng
		LEFT JOIN
		gooagoo_goods.goods_base_info gbis ON gsng.goods_id =
		gbis.goods_id
		LEFT JOIN gooagoo_shop.shop_info gssi ON gbis.shop_id =
		gssi.shop_id
		LEFT JOIN gooagoo_shop.shop_entity_info gssei ON
		gbis.shop_entity_id =
		gssei.shop_entity_id
		WHERE 1=1 AND
		gsng.is_del = 'N'
		<if test="nominateGoodsBusiness.goodsName != null">
			AND gbis.goods_name like
			CONCAT('%',#{nominateGoodsBusiness.goodsName},'%')
		</if>
		<if test="nominateGoodsBusiness.goodsId != null">
			AND gsng.goods_id=#{nominateGoodsBusiness.goodsId}
		</if>
		<if test="nominateGoodsBusiness.shopId != null">
			AND gsng.shop_id=
			#{nominateGoodsBusiness.shopId}
		</if>
		<if test="nominateGoodsBusiness.Id != null">
			AND gsng.id=
			#{nominateGoodsBusiness.Id}
		</if>
		<if test="nominateGoodsBusiness.shopEntityId != null">
			AND gsng.shop_entity_id=
			#{nominateGoodsBusiness.shopEntityId}
		</if>
		<if test="nominateGoodsBusiness.shopName != null">
			AND gssi.shop_name like
			CONCAT('%',#{nominateGoodsBusiness.shopName},'%')
		</if>
		<if test="nominateGoodsBusiness.shopEntityName != null">
			AND gssei.shop_entity_name like
			CONCAT('%',#{nominateGoodsBusiness.shopEntityName},'%')
		</if>
		<if test="nominateGoodsBusiness.startTime != null">
			AND gsng.start_time >=
			#{nominateGoodsBusiness.startTime}
		</if>
		<if test="nominateGoodsBusiness.endTime != null">
			AND gsng.end_time &lt;=
			#{nominateGoodsBusiness.endTime}
		</if>
		) gsngs where 1=1
	</select>
</mapper>